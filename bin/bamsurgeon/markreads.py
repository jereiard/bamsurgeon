#!/usr/bin/env python

import pysam
import sys


def markreads(bamfn, fasta_ref, outfn):
    bam = pysam.AlignmentFile(bamfn, reference_filename=fasta_ref)
    out = pysam.AlignmentFile(outfn, 'wb', template=bam)

    for read in bam.fetch(until_eof=True):
        #tags = read.tags
        #tags.append(('BS',1))
        read.set_tag('BS',1,'i')
        read.set_tag('ZM',(262,-46,260,-14,14,202,14,200,456,-28,2,12,222,-14,246,474,-8,494,0,-40,254,244,210,302,242,34,2,196,-30,8,254,-52,16,238,48,232,54,284,476,46,254,296,40,468,-2,6,484,-2,224,536,-4,-16,280,58,466,0,264,10,48,-4,252,248,256,16,216,-2,16,442,30,194,-24,222,12,696,446,490,0,4,460,24,244,238,-8,222,226,6,220,-24,0,-22,14,0,496,48,10,38,250,42,-34,520,248,-18,42,714,28,262,220,22,476,260,246,12,12,-34,678,0,4,610,12,198,70,224,46,32,222,38,92,62,238,84,14,994,730,-18,6,290,12,-44,-10,16,200,466,14,-2,280,-22,148,224,74,2,904,236,0,450,20,42,496,8,60,20,438,24,0,512,42,2,314,26,520,26,-8,514,-8,-30,938,252,74,-14,244,24,-14,330,16,234,6,222,16,-50,250,36,2,26,276,0,420,0,-36,262,-26,740,6,684,258,248,216,292,86,22,422,482,-8,-22,228,-34,276,6,20,-2,0,-2,484,274,244,-6,14,244,-2,436,0,-22,240,60,208,14,4,450,196,312,10,242,-12,18,222,-120,-32,210,24,236,22,392,-10,20,228,192,248,228,204,60,-26,264,40,8,268,-22,208,-62,0,212,-18,52,264,-8,646,334,12,-56,318,190,258,32,274,242,92,40,490,-16,0,6,500,-16,-6,488,244,180,12,1008,86,-4,76,92,220,656,6,2,288,450,36,-56,268,218,100,212,22,532,34,-10,284,-6,80,-16,426,8,-6,260,32,-22,258,286,222,14,70,244,-48,-14,466,656,50,44,238,-28,20,488,80,6,226,268,-10,426,102,106,480,58,34,206,-24,70,418,36,224,98,210,-2,0,250,44,-12,250,6,450,240,-2,-34,200,4,232,4,18,32,-10,32,442,214,288,282,86,86,0,228,56,-18,388,10,-16,54,-50,-4,208,310,80,254,50,50,224,154,198,300,54,246,-10,10,-24,34,434,4,262,-74,14,242),'B',False)
        #read.tags = tags
        out.write(read)

if __name__ == '__main__':
    if len(sys.argv) == 3:
        markreads(*sys.argv[1:])

    else:
        sys.exit('usage: %s <input BAM> <output BAM>' % sys.argv[0])
            
